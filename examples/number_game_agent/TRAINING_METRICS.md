# 训练指标说明与对比

## 📊 核心指标定义（5个最重要）

| 指标 | 含义 | 好坏标准 |
|------|------|---------|
| **`val/accuracy_reward`** | 验证集准确率（最重要） | >90%优秀，>85%良好，<60%失败 |
| **`reward/accuracy`** | 训练集准确率 | 应高于验证集，但差距<10% |
| **`actor/kl_loss`** | KL散度（策略偏离度） | <0.5安全，<0.1保守，>1.0危险 |
| **`actor/pg_loss`** | 策略梯度损失 | 接近0表示收敛 |
| **`perf/time_per_step`** | 每步训练耗时（秒） | 越小越好 |

### 辅助指标

- **`actor/entropy_loss`**: 熵损失，低=模型输出确定（已收敛）
- **`critic/advantages/max`**: GRPO优势函数最大值，反映样本质量差异
- **`perf/throughput`**: 训练吞吐量（tokens/s），越高越好
- **`perf/max_memory_allocated_gb`**: GPU显存使用（H20总80GB）

---

## 📈 训练结果对比

### Run 1: 快速测试（5 epochs）

**时间**: 2025-11-20 11:08-12:15
**WandB**: https://wandb.ai/zhangyuehua_rh-ss/Mobile_Number_Game_RL/runs/uw8ef58x

| 指标 | 结果 | 评价 |
|------|------|------|
| **验证准确率** | **91.67%** | ⭐⭐⭐⭐⭐ 优秀 |
| **训练准确率** | **96.25%** | ⭐⭐⭐⭐⭐ 优秀 |
| **泛化能力** | Gap=4.58% | ✅ 无过拟合 |
| **KL散度** | 0.3457 | ✅ 健康（<0.5） |
| **策略损失** | 1.57e-09 | ✅ 完全收敛 |
| **训练步数** | 35 steps | 5 epochs × 7 steps |
| **总训练时间** | 67分钟 | ~1.9秒/step |
| **显存使用** | 40.2 GB | ✅ 充足（25%） |

**收敛曲线：**
```
Step 0:  30.00% (baseline)
Step 7:  [第1个epoch结束，数据未记录]
Step 14: [第2个epoch结束，验证点]
Step 21: [第3个epoch结束]
Step 28: [第4个epoch结束，验证点]
Step 35: 91.67% (最终验证)
```

**结论：** 5 epochs已达91.67%，模型成功学会3条游戏规则。收敛速度快，训练稳定。

---

### Run 2: 完整训练（12 epochs）

**时间**: [待补充]
**WandB**: [待补充]

| 指标 | 结果 | 对比Run 1 |
|------|------|-----------|
| **验证准确率** | [待补充] | [待补充] |
| **训练准确率** | [待补充] | [待补充] |
| **泛化能力** | [待补充] | [待补充] |
| **KL散度** | [待补充] | [待补充] |
| **策略损失** | [待补充] | [待补充] |
| **训练步数** | 84 steps | 12 epochs × 7 steps |
| **总训练时间** | [待补充] | [待补充] |
| **显存使用** | [待补充] | [待补充] |

**预期结果：**
- 验证准确率: 95-96%（+3-4%提升）
- 收敛更充分，可能在Epoch 8-10达到稳定

---

## 🔍 WandB查看指南（精简版）

### 必看三步

1. **Overview → Summary** → 搜索 `val/accuracy_reward`
   - 这是最终成绩单

2. **Charts** → 查看以下曲线：
   - `val/accuracy_reward`（验证准确率曲线）
   - `reward/accuracy`（训练准确率曲线）
   - `actor/kl_loss`（KL散度，应<0.5）

3. **System** → 查看 `GPU Memory`
   - 确认没有OOM

### 判断训练好坏

```
✅ 训练成功的标志：
  - val/accuracy > 85%
  - 训练/验证准确率差距 < 10%
  - KL散度 < 0.5
  - 曲线平滑上升并收敛

❌ 训练失败的标志：
  - val/accuracy < 60%
  - 训练/验证差距 > 15%（过拟合）
  - KL散度 > 1.0（策略崩溃）
  - 曲线剧烈波动或不收敛
```

---

## 📝 快速对比模板

完整训练结束后，使用此模板快速对比：

```
Run 1 (5 epochs):  验证91.67% | 训练96.25% | KL=0.35
Run 2 (12 epochs): 验证[  ]% | 训练[  ]% | KL=[  ]

提升: +[  ]%
结论: [收敛更好/差异不大/过拟合]
```

---

## 🎯 指标异常诊断

| 症状 | 可能原因 | 解决方案 |
|------|---------|---------|
| 验证准确率不提升 | 学习率太低 | 提高lr到1e-5 |
| 训练准确率高但验证低 | 过拟合 | 减少epochs或增加数据 |
| KL散度>1.0 | 学习率太高 | 降低lr到1e-6 |
| Loss=NaN | 梯度爆炸 | 检查数据或降低lr |
| GPU利用率<50% | 数据加载慢 | 减少验证频率 |

---

**更新记录：**
- 2025-11-20: 初始版本，记录Run 1（5 epochs快速测试）
- [待补充]: Run 2（12 epochs完整训练）
